{% extends "base.html" %}
{% load static %}
{% block title %}Inclusão que Transforma{% endblock %}

{% block content %}
<div class="grid xl:grid-cols-3 gap-8">
  <section class="xl:col-span-2">
    <div x-data="{ tab: 'projeto' }" class="card bg-white shadow-soft rounded-xl2">
      <div class="card-body">
        <!-- Tabs permanecem em brand (azul) -->
        <div class="flex flex-wrap gap-2 bg-brand-100 p-2 rounded-xl">
          <button class="px-4 py-2 rounded-lg font-medium shrink-0"
                  :class="tab==='projeto' ? 'bg-brand-500 text-white' : 'text-brand-700 hover:bg-brand-50'"
                  @click="tab='projeto'">Projeto</button>
          <button class="px-4 py-2 rounded-lg font-medium shrink-0"
                  :class="tab==='equipes' ? 'bg-brand-500 text-white' : 'text-brand-700 hover:bg-brand-50'"
                  @click="tab='equipes'">Equipe & Benefícios</button>
          <button class="px-4 py-2 rounded-lg font-medium shrink-0"
                  :class="tab==='leis' ? 'bg-brand-500 text-white' : 'text-brand-700 hover:bg-brand-50'"
                  @click="tab='leis'">Leis & Informações</button>
        </div>

        <div class="mt-6">
          <div x-show="tab==='projeto'">
            {% include "content/_aba1_projeto.html" %}
          </div>
          <div x-show="tab==='equipes'">
            {% include "content/_aba2_equipes.html" %}
          </div>
          <div x-show="tab==='leis'">
            {% include "content/_aba3_leis.html" %}
          </div>
        </div>
      </div>
    </div>
  </section>

  <aside class="space-y-6">
    <div class="card bg-white shadow-soft rounded-xl2">
      <div class="card-body">
        <h2 class="card-title text-brand-800">Seja parceiro(a)</h2>
        <p class="text-sm text-gray-600 mb-2">Preencha o formulário para participar.</p>

        <form method="post" class="space-y-4">
          {% csrf_token %}
          <label class="form-control w-full">
            <span class="label-text">Razão social:</span>
            {{ form.company_name }}
          </label>

          <label class="form-control w-full">
            <span class="label-text">CNPJ:</span>
            {{ form.cnpj }}
          </label>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <label class="form-control">
              <span class="label-text">Representante legal:</span>
              {{ form.legal_representative }}
            </label>
            <label class="form-control">
              <span class="label-text">Cargo:</span>
              {{ form.role }}
            </label>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <label class="form-control">
              <span class="label-text">Telefone:</span>
              {{ form.phone }}
            </label>
            <label class="form-control">
              <span class="label-text">E-mail:</span>
              {{ form.email }}
            </label>
          </div>

          <label class="form-control w-full">
            <span class="label-text">Deseja participar como:</span>
            {{ form.participation_type }}
          </label>

          <label class="form-control w-full">
            <span class="label-text">Mensagem (opcional):</span>
            {{ form.message }}
          </label>

          <!-- Botão de envio LARANJA -->
          <button class="btn w-full border-0 bg-orange-500 hover:bg-orange-600 text-white">
            Enviar
          </button>
        </form>
      </div>
    </div>

    <div class="card bg-white shadow-soft rounded-xl2">
      <div class="card-body items-center text-center">
        <!-- Botão outline agora com borda/hover laranja -->
        <a href="{{ whatsapp_link }}" target="_blank"
           class="btn btn-outline w-full mb-3 border-0 bg-orange-500 hover:bg-orange-600 text-white">
          Abrir conversa
        </a>
        <img src="{% static 'img/qr_eleni.png' %}" alt="QR WhatsApp Eleni" class="w-44 h-44 object-contain mx-auto">
        <p class="text-xs text-gray-500 mt-2">Escaneie o QR para falar com a Equipe</p>
      </div>
    </div>
  </aside>
</div>

<!-- Script de máscaras -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const qs = (sel) => document.querySelector(sel);
  const pick = (...sels) => sels.map(qs).find(Boolean);

  const $phone  = pick('input[name="phone"]', '#id_phone');
  const $cnpj   = pick('input[name="cnpj"]', '#id_cnpj');
  const $razao  = pick('input[name="company_name"]', '#id_company_name');

  const onlyDigits = (v) => (v || '').replace(/\D+/g, '');

  function formatPhone(v) {
    const d = onlyDigits(v).slice(0, 11);
    if (!d) return '';
    if (d.length <= 10) {
      const p1 = d.slice(0, 2);
      const p2 = d.slice(2, 6);
      const p3 = d.slice(6, 10);
      return p3 ? `(${p1}) ${p2}-${p3}` : p2 ? `(${p1}) ${p2}` : `(${p1}`;
    } else {
      const p1 = d.slice(0, 2);
      const p2 = d.slice(2, 7);
      const p3 = d.slice(7, 11);
      return p3 ? `(${p1}) ${p2}-${p3}` : p2 ? `(${p1}) ${p2}` : `(${p1}`;
    }
  }

  function formatCNPJ(v) {
    const d = onlyDigits(v).slice(0, 14);
    if (!d) return '';
    const p1 = d.slice(0, 2);
    const p2 = d.slice(2, 5);
    const p3 = d.slice(5, 8);
    const p4 = d.slice(8, 12);
    const p5 = d.slice(12, 14);

    let out = p1;
    if (p2) out += '.' + p2;
    if (p3) out += '.' + p3;
    if (p4) out += '/' + p4;
    if (p5) out += '-' + p5;
    return out;
  }

  function toTitleCase(str) {
    return (str || '')
      .trim()
      .replace(/\s+/g, ' ')
      .toLowerCase()
      .replace(/\b([a-zà-ú])([a-zà-ú]*)/gi, (m, a, b) => a.toUpperCase() + b);
  }

  if ($phone) {
    $phone.setAttribute('inputmode', 'tel');
    $phone.setAttribute('maxlength', '16');
    $phone.addEventListener('input', (e) => {
      e.target.value = formatPhone(e.target.value);
    });
    if ($phone.value) $phone.value = formatPhone($phone.value);
  }

  if ($cnpj) {
    $cnpj.setAttribute('inputmode', 'numeric');
    $cnpj.setAttribute('maxlength', '18');
    $cnpj.addEventListener('input', (e) => {
      e.target.value = formatCNPJ(e.target.value);
    });
    if ($cnpj.value) $cnpj.value = formatCNPJ($cnpj.value);
  }

  if ($razao) {
    $razao.addEventListener('blur', (e) => {
      e.target.value = toTitleCase(e.target.value);
    });
  }
});
</script>
{% endblock %}
